<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,500;0,600;0,700;1,500&amp;display=swap&amp;_v=20220324092620" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="container">
    <button class="btn">
      Кликни
    </button>
  </main>
  <div class="popup-overlay hidden">
    <div class="popup-body">
      <p class="popup-close">×</p>
      <div class="popup-content">
        <div class="row">
          <div class="col-1">
            <h2 class="popup-title">
              Получите набор файлов
            <br>
              для руководителя:
            </h2>
            <picture style="z-index: 3;">
              <source srcset="img/docs.webp" type="image/webp">
              <img src="img/docs.png" alt="docs-icons" class="docs">
            </picture>
            <picture>
              <source srcset="img/img.webp" type="image/webp">
              <img src="img/img.png" alt="files" class="files">
            </picture>
          </div>
          <div class="col-2">
            <div class="popup-form">
              <form name="form1" id="amoforms_form" class="amoforms-form amoforms-view-form" action="amo.php" method="POST" enctype="multipart/form-data">
                <label for="fields[427977_1][258931]">
                  Введите Email для получения файлов:
                </label>
                <input type="email" placeholder="E-mail" id="email" name="fields[427977_1][258931]">
                <label for="fields[427975_1][258919]">
                  Введите телефон для подтверждения доступа:
                </label>
                <input type="text" class="amoforms-validate_phone tel" id="phone" name="fields[427975_1][258919]"  placeholder="+7 (000) 000-00-00" required="required">
                <p class="error" id="error" style="display: none;">
                  *Обязателно для заполнения
                </p>
                <input type="hidden" name="form_id" id="form_id" value="914062">
              <input type="hidden" name="hash" value="041076d1e4ff0cdbe892974261c447af">
               <button type="submit" class="validateBtn">
                 Скачать файлы
                 <picture>
                   <source srcset="img/btn-ico.webp" type="image/webp">
                   <img src="img/btn-ico.png" alt="btn-ico"></picture>
                </button>
              </form>
              <div class="file-size">
                <span>
                  PDF 4,7 MB
                </span>
                <span>
                  DOC 0,8 MB
                </span>
                <span>
                  XLS 1,2 MB
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    var popup = document.querySelector(".popup-overlay");
    var btn = document.querySelector(".btn");
    var close = document.querySelector(".popup-close");

    btn.addEventListener("click", function(event){
        event.preventDefault();
        popup.classList.remove("hidden");
    });

    popup.addEventListener("click", function(event) {
      e = event || window.event
      if (e.target == this) {
        popup.classList.add("hidden");
      }
    });

    close.addEventListener("click", function(event){
        event.preventDefault();
        popup.classList.add("hidden");
    });

    window.addEventListener("DOMContentLoaded", function() {
    [].forEach.call( document.querySelectorAll('.tel'), function(input) {
    var keyCode;
      function mask(event) {
          event.keyCode && (keyCode = event.keyCode);
          var pos = this.selectionStart;
          if (pos < 3) event.preventDefault();
          var matrix = "+7 (___) ___-__-__",
              i = 0,
              def = matrix.replace(/\D/g, ""),
              val = this.value.replace(/\D/g, ""),
              new_value = matrix.replace(/[_\d]/g, function(a) {
                  return i < val.length ? val.charAt(i++) || def.charAt(i) : a
              });
          i = new_value.indexOf("_");
          if (i != -1) {
              i < 5 && (i = 3);
              new_value = new_value.slice(0, i)
          }
          var reg = matrix.substr(0, this.value.length).replace(/_+/g,
              function(a) {
                  return "\\d{1," + a.length + "}"
              }).replace(/[+()]/g, "\\$&");
          reg = new RegExp("^" + reg + "$");
          if (!reg.test(this.value) || this.value.length < 5 || keyCode > 47 && keyCode < 58) this.value = new_value;
          if (event.type == "blur" && this.value.length < 5)  this.value = ""
      }

      input.addEventListener("input", mask, false);
      input.addEventListener("focus", mask, false);
      input.addEventListener("blur", mask, false);
      input.addEventListener("keydown", mask, false)

    });

  });

  var form = document.querySelector('.amoforms-form')
  var validateBtn = form.querySelector('.validateBtn')
  // form.addEventListener('submit', function (event) {
  // event.preventDefault()
  // console.log('clicked on validate')
  // })
  form.addEventListener('submit', function (event) {
    var phone = document.getElementById('phone').value
    phone = phone.substr(1);
    var regex = /^[\d]{1}\ \([\d]{2,3}\)\ [\d]{2,3}-[\d]{2,3}-[\d]{2,3}$/;
    if(regex.test(phone) === false) {
      document.getElementById("error").style.display = "block";
      event.preventDefault();
    }
  });
  </script>
</body>
</html>